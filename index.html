 <html>
  <head>
    <title> SAF-T-
            analyse i
            nettleseren
            med Python og pandas</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="stylesheet" href="static/pyodide/pyscript.css" />
    <script defer src="static/pyodide/pyscript.min.js"></script>
    <link rel="manifest" href="manifest.json">
    </head>
    <body>
    
        <py-config>
            packages = ["pandas"]

            [[runtimes]]
                src = "static/pyodide/pyodide.js"
                name = "pyodide-0.21.3"
                lang = "python"
            
            [[fetch]]
            from = "static/python/"
            files = ["saft2dataframe.py", "analyse.py", "request.py", "oppsett_for_lesing_av_lokal_fil.py"]
            
    
          </py-config>
          <py-script src="static/python/main.py">
          </py-script>
    
    <div style="width: 45%; padding-right: 3%; padding-left: 2%; float: left">
      <h1>Analyse av SAF-T-fil i nettleseren</h1>
      <p>
      Denne nettsiden lar deg åpne en SAF-T-fil, og bruke Python og pandas til å gjøre analyser av innholdet, uten at du trenger å ha Python installert på PC-en, alt kjører i nettleseren.
      </p>
      <p>Du kan bruke noen av de forhåndsdefinerte spørringene/analysene, enten direkte eller med egne tilpasninger, eller du kan skrive din egen kode </p>
      <p>I variabelen <code>saft</code> ligger det en pandas dataframe som inneholder alle transaksjonene fra SAF-T-fila. Prøv f.eks. <code>saft.info()</code> eller <code>saft.describe()</code> for å få litt informasjon om datasettet</p>
      <p>Nettsiden kan også installeres lokalt. Fremgangsmåten varierer mellom de ulike nettleserne. I Vivaldi, høyreklikk på fanen og velg menyvalget "Installer Analyse av SAF-T-fil i nettleseren med Python og pandas". I Chrome, se eget installasjonsikon i adressefeltet.</p>
      <h2>
        Velg SAF-T-fil
      </h2>
      <p>
        Nettsiden laster automatisk en eksempelfil fra Skatteetaten, så du kan teste koden nedenfor uten å ha en egen fil. Men hvis du ønsker å åpne en egen fil, gjør du det gjennom dialogen nedenfor. Deretter må du kjøre koden under.
      </p>
      <br />
      <label for="myfile">Velg fil:</label>
      <input type="file" id="myfile" name="myfile"/>
      <br/>
      <py-repl>
        # kjør denne cellen (Shift-Enter) for hente dataene
        # fra filen du har valgt
        import io
        saft = saft2dataframe(hent_saft_innhold())
      </py-repl>
      <p id="content"></p>
      <h2>Omsetningstall for en måned</h2>
      <p>Bytt ut datoene for å få den aktuelle tidsperioden. Dette er omsetningstallene SSB ber om dersom du er trukket ut til å besvare spørreskjema for varehandelsindeksen.</p>
      <py-repl>
        from pprint import pprint  # for penere formattering av resultatet
        resultat = analyse(
            from_and_included_date = '2017-01-01',
            to_date = '2017-02-01',
            from_and_included_account_id = 3000,
            to_account_id = 4000,
            df = saft,  # "saft" er en dataframe med dataene fra xml-fila. Prøv "saft.info()"      
        )
        pprint(resultat)

      </py-repl>
      <h2>Info om dataene</h2>
      <py-repl>
        print(saft.info())  # gir informasjon om alle kolonnene
      </py-repl>
      <py-repl>
        print(saft.describe())  # beregner statistiske nøkkeltall for de numeriske dataene
      </py-repl>
      <h2>Demo av http-forespørsler</h2>
      <p>Se main.py for selve koden, nedenfor er kallet som kjører demo-funksjonen</p>
      <py-repl>asyncio.ensure_future(http_request_demo())</py-repl>
    </div>
      <div style="width: 40%; padding-left: 10%; float: right"
      <py-terminal></py-terminal>
    </div>
      </body>
    <script src="./static/js/main.js"></script>
    </body>
</html>